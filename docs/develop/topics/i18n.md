# Internationalization and Localization

## Babel

## Marking strings for translation
In order to translate strings, they have to be marked. This ensures that they will be picked up by the extraction process later on. Only strings which are visible in the UI have to be translated.

### Python
Marking strings in python is done via the `Flask-BabelEx` package. First, make sure to import the package and the `*gettext` function. We usually import it as `_` to be consistent throughout different packages.

```python
from flask_babelex import lazy_gettext as _
```

Now strings can be marked for translation:
```python
error_message = _("Invalid scheme")
```

Certain data, identifiers or keywords do not have to be translated. This can be achieved with string interpolation:
```python
_("Invalid {scheme}").format(scheme)
```

Adding notes for translators helps them to better understand the context where this string will be used:
```python
# NOTE: This is displayed in ....
_("Invalid {scheme}").format(scheme)
```

#### Jinja Templates
The `gettext` function is made available in jinja templates as well:
```js
<p>
    {{ _('Only published versions are displayed.') }}
</p>
```

### JavaScript
Marking strings in JavaScript is done via the `i18next` module. First, make sure to import `i18next` from the module.
```js
import { i18next } from "@translations/invenio_app_rdm/i18next";
```

Now strings can be marked for translation:
```js
<p>
    {i18next.t('Only published versions are displayed.')}
</p>
```



## Lazy vs non-lazy


## EDTF localization


## Storing timestamps

- Always in UTC
- Localize on display

## Storing strings

Unicode - UTF8


## Extracting Strings
After strings have been marked for translation, it is now time to extract them. Instructions on how to do so can be found in the respective package in the file located at `.tx/config`. Depending on the packag, only Python or JavaScript may be available for translation.

### Python
In the root folder of the package run
```
python setup.py extract_messages
```
This command will gather all the marked strings from .py and jinja template files, group them by their ID and place everything in the source file specified in the config (usually at `<package_name>/translations/messages.pot`).

### JavaScript
Navigate to the `<package_name>/theme/assets/semantic-ui/translations/<package_name>` folder.
Install i18n dev dependencies via
```
npm install
```
Now run
```
npm run extract_messages
```
This command will gather all the marked strings from .js files, group them by their ID and place everything in the source file specified in the config (usually at `<package_name>/theme/assets/semantic-ui/translations/<package_name>/translations.pot`).

## Transifex
push source files
pull translation files
